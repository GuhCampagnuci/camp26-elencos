<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>CAMP 2026 ‚Äî In√≠cio</title>

<style>
  :root{
    --bg:#0b0f17;
    --text:#e7eefc;
    --muted:#9bb0d1;
    --line:#22314f;
    --accent:#7c5cff;
    --danger:#ff5c7a;
    --ok:#4ade80;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
    --radius: 16px;

    /* ‚úÖ larguras padr√£o (desktop) */
    --w-pos: 54px;
    --w-team: 280px;
    --w-p: 70px;
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:system-ui, Arial, sans-serif;
    background:var(--bg);
    color:var(--text);
    padding-bottom:84px;
    overflow-x:hidden;
  }
  .wrap{max-width:1100px;margin:0 auto;padding:14px}
  .card{
    background: linear-gradient(180deg, rgba(18,26,42,.92), rgba(15,22,38,.92));
    border:1px solid rgba(34,49,79,.75);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow:hidden;
    margin-top: 12px;
  }
  .bd{padding:14px}

  header{
    position: sticky; top:0; z-index:10;
    backdrop-filter: blur(10px);
    background: rgba(11,15,23,.65);
    border-bottom:1px solid rgba(34,49,79,.65);
  }
  .top{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
  }
  .title{font-weight:1000;font-size:16px;letter-spacing:.4px}
  .api{
    display:inline-flex; align-items:center; gap:8px;
    padding: 6px 10px; border-radius: 999px;
    border:1px solid rgba(34,49,79,.85);
    background: rgba(9,12,18,.55);
    font-size: 12px; font-weight: 900; color: var(--muted);
    white-space: nowrap;
  }
  .dot{ width:8px; height:8px; border-radius:999px; background: var(--muted); }

  .state{
    margin-top: 12px;
    padding: 12px;
    border-radius: 12px;
    border:1px solid rgba(34,49,79,.75);
    background: rgba(9,12,18,.40);
    color: var(--muted);
    font-size: 13px;
    white-space: pre-wrap;
  }

  /* ============ TABELA (com scroll no toque) ============ */
  .tableWrap{
    border:1px solid rgba(34,49,79,.75);
    border-radius: 14px;
    background: rgba(9,12,18,.28);
    margin-top: 12px;

    overflow-x:auto;
    overflow-y:hidden;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-x;

    padding-bottom: 2px;
  }

  .hint{
    margin-top: 10px;
    color: var(--muted);
    font-size: 12px;
    display:flex;
    align-items:center;
    gap:8px;
  }
  .hint span{
    display:inline-flex;
    padding:4px 10px;
    border-radius:999px;
    border:1px solid rgba(34,49,79,.65);
    background: rgba(9,12,18,.35);
  }

  table{
    width:100%;
    border-collapse: collapse;
    min-width: 860px; /* for√ßa scroll p/ celular */
  }
  th, td{
    padding: 12px 10px;
    border-bottom: 1px solid rgba(34,49,79,.55);
    font-size: 13px;
    white-space: nowrap;
    background: transparent;
  }
  th{
    color: var(--muted);
    font-weight: 1000;
    background: rgba(9,12,18,.35);
  }
  th.num, td.num{ text-align:center; }

  /* ‚úÖ COLUNAS FIXAS */
  .sticky{
    position: sticky;
    z-index: 3;
    background: rgba(9,12,18,.92);
  }

  .col-pos{ width: var(--w-pos); text-align:center; font-weight:1000; color:var(--muted); }
  .col-team{ width: var(--w-team); font-weight:1000; letter-spacing:.3px; }
  .col-p{ width: var(--w-p); }

  .stickyPos{ left: 0; }
  .stickyTeam{ left: var(--w-pos); }
  .stickyP{ left: calc(var(--w-pos) + var(--w-team)); }

  .pill{
    font-size:12px;
    padding: 3px 10px;
    border-radius: 999px;
    border:1px solid rgba(124,92,255,.30);
    background: rgba(124,92,255,.15);
    color: var(--text);
    font-weight: 1000;
    display:inline-flex;
    justify-content:center;
    min-width: 44px;
  }

  tr:hover td{ background: rgba(124,92,255,.06); }
  tr:hover td.sticky, tr:hover th.sticky{
    background: rgba(9,12,18,.92);
  }

  /* ‚úÖ MOBILE: encolhe a parte travada e alinha melhor */
  @media (max-width: 520px){
    :root{
      --w-pos: 42px;
      --w-team: 170px;
      --w-p: 56px;
    }
    th, td{ padding: 11px 8px; }
    .col-team{ letter-spacing: .2px; }
    .pill{ min-width: 38px; padding: 3px 8px; }
    table{ min-width: 720px; }
  }

  /* MENU MOBILE */
  nav.mobileNav{
    position: fixed;
    bottom: 0; left: 0; right: 0;
    height: 74px;
    background: rgba(11,15,23,.85);
    backdrop-filter: blur(10px);
    border-top: 1px solid rgba(34,49,79,.6);
    z-index: 50;
  }
  .navWrap{
    max-width: 1100px;
    margin: 0 auto;
    height: 100%;
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 6px;
    padding: 8px 8px;
  }
  .navItem{
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:4px;
    padding: 6px 6px;
    border-radius: 14px;
    border: 1px solid transparent;
    color: var(--muted);
    font-size: 10px;
    user-select:none;
    text-decoration:none;
  }
  .navItem .ico{ font-size: 16px; }
  .navItem.active{
    color: var(--text);
    border-color: rgba(124,92,255,.35);
    background: rgba(124,92,255,.10);
  }
</style>
</head>

<body>

<header>
  <div class="wrap">
    <div class="top">
      <div class="title">üèÜ CAMP 2026 ‚Äî Tabela</div>
      <div class="api"><span class="dot" id="apiDot"></span><span id="apiTxt">API</span></div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="card">
    <div class="bd">
      <div class="state" id="state">Carregando tabela‚Ä¶</div>

      <div class="hint" id="hint" style="display:none;">
        <span>üëà arraste pro lado</span>
        <div>para ver todas as colunas</div>
      </div>

      <div class="tableWrap" id="tableWrap" style="display:none;">
        <table>
          <thead>
            <tr>
              <th class="col-pos sticky stickyPos">#</th>
              <th class="col-team sticky stickyTeam">TIME</th>
              <th class="col-p num sticky stickyP">P</th>

              <th class="num">J</th>
              <th class="num">V</th>
              <th class="num">E</th>
              <th class="num">D</th>
              <th class="num">GP</th>
              <th class="num">GC</th>
              <th class="num">SG</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>

      <div style="margin-top:10px;color:var(--muted);font-size:12px;">
        Regras: Vit√≥ria = 3 pts ‚Ä¢ Empate = 1 pt ‚Ä¢ Derrota = 0 pts
      </div>
    </div>
  </div>
</main>

<nav class="mobileNav" aria-label="Menu">
  <div class="navWrap">
    <a class="navItem active" href="index.html"><div class="ico">üè†</div><div>In√≠cio</div></a>
    <a class="navItem" href="elencos.html"><div class="ico">üßë‚Äçü§ù‚Äçüßë</div><div>Elencos</div></a>
    <a class="navItem" href="disponibilidade.html"><div class="ico">üìÖ</div><div>Disp.</div></a>
    <a class="navItem" href="desafios.html"><div class="ico">‚öîÔ∏è</div><div>Desafios</div></a>
    <a class="navItem" href="reportar_partida.html"><div class="ico">üìù</div><div>Reportar</div></a>
    <a class="navItem" href="estatisticas.html"><div class="ico">üìä</div><div>Stats</div></a>
    <a class="navItem" href="regras.html"><div class="ico">üìú</div><div>Regras</div></a>
  </div>
</nav>

<script>
  const API_BASE = "https://script.google.com/macros/s/AKfycbyi1AWCya8OjxVMVWt7JT3CqivvwgKzzRZeH3UQgzQ0Iik3-zTqvgChddwmuKm0E0JLLA/exec";

  const apiDot = document.getElementById("apiDot");
  const apiTxt = document.getElementById("apiTxt");
  const state = document.getElementById("state");
  const tableWrap = document.getElementById("tableWrap");
  const hint = document.getElementById("hint");
  const tbody = document.getElementById("tbody");

  function setApi(ok){
    apiDot.style.background = ok ? "var(--ok)" : "var(--danger)";
    apiTxt.textContent = ok ? "API OK" : "API OFF";
    apiTxt.style.color = ok ? "var(--ok)" : "var(--danger)";
  }

  function esc(s){
    return String(s ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function jsonp(route, params = {}) {
    return new Promise((resolve, reject) => {
      const cb = "cb_" + Math.random().toString(36).slice(2);
      const url = new URL(API_BASE);
      url.searchParams.set("route", route);
      url.searchParams.set("callback", cb);
      url.searchParams.set("_ts", Date.now());

      Object.entries(params).forEach(([k,v]) => {
        if (v !== undefined && v !== null && String(v).trim() !== "") url.searchParams.set(k, v);
      });

      const s = document.createElement("script");
      s.src = url.toString();
      s.async = true;

      const t = setTimeout(() => { cleanup(); reject(new Error("timeout")); }, 12000);

      function cleanup(){
        clearTimeout(t);
        if(s.parentNode) s.parentNode.removeChild(s);
        try{ delete window[cb]; }catch(_){ window[cb] = undefined; }
      }

      window[cb] = (data) => { cleanup(); resolve(data); };
      s.onerror = () => { cleanup(); reject(new Error("load_failed")); };
      document.head.appendChild(s);
    });
  }

  function normalizeRow(x){
    // suporta chaves em mai√∫sculo/min√∫sculo
    const get = (k1, k2) => (x && (x[k1] !== undefined ? x[k1] : x[k2]));
    const time = get("time","TIME");
    return {
      time: String(time || "").toUpperCase(),
      P: get("P","p") ?? get("pts","PTS") ?? 0,
      J: get("J","j") ?? 0,
      V: get("V","v") ?? 0,
      E: get("E","e") ?? 0,
      D: get("D","d") ?? 0,
      GP: get("GP","gp") ?? 0,
      GC: get("GC","gc") ?? 0,
      SG: get("SG","sg") ?? ((Number(get("GP","gp")||0) - Number(get("GC","gc")||0)))
    };
  }

  async function loadTabela(){
    state.style.display = "";
    state.textContent = "Carregando tabela‚Ä¶";
    tbody.innerHTML = "";
    tableWrap.style.display = "none";
    hint.style.display = "none";

    try{
      // ‚úÖ rota correta da sua API (tabela)
      const r = await jsonp("tabela");
      setApi(true);

      if (!r || !r.ok){
        state.textContent = "‚ö†Ô∏è API respondeu, mas deu erro.\n\nDetalhe: " + (r && r.error ? r.error : "Resposta inv√°lida");
        return;
      }

      // ‚úÖ aceita tanto 'tabela' quanto vers√µes antigas 'standings'
      const list = Array.isArray(r.tabela) ? r.tabela : (Array.isArray(r.standings) ? r.standings : []);
      if (list.length === 0){
        state.textContent = "Sem times (TIMES01 est√° vazio?).";
        return;
      }

      const normalized = list.map(normalizeRow);

      state.style.display = "none";
      tableWrap.style.display = "";
      hint.style.display = "";

      tbody.innerHTML = normalized.map((x, idx) => `
        <tr>
          <td class="col-pos sticky stickyPos">${idx+1}</td>
          <td class="col-team sticky stickyTeam">${esc(x.time)}</td>
          <td class="col-p num sticky stickyP"><span class="pill">${esc(x.P)}</span></td>

          <td class="num">${esc(x.J)}</td>
          <td class="num">${esc(x.V)}</td>
          <td class="num">${esc(x.E)}</td>
          <td class="num">${esc(x.D)}</td>
          <td class="num">${esc(x.GP)}</td>
          <td class="num">${esc(x.GC)}</td>
          <td class="num">${esc(x.SG)}</td>
        </tr>
      `).join("");

    }catch(err){
      setApi(false);
      state.textContent = "‚ùå API OFF.\n\nErro: " + (err && err.message ? err.message : String(err));
    }
  }

  loadTabela();
</script>

</body>
</html>
